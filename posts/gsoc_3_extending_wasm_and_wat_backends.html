<!DOCTYPE html><html><head><title>Ubaid Shaikh</title><meta name="description" content="This is Ubaid Shaikh&#x27;s portfolio Website"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta charSet="UTF-8"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/63637aae99d8f3d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/63637aae99d8f3d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-e7a7892cb0edc024.js" defer=""></script><script src="/_next/static/chunks/pages/_app-70174acae681883c.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-8d0d04d2d87907dd.js" defer=""></script><script src="/_next/static/f2LKLLTRFDOqa9_r6tCT6/_buildManifest.js" defer=""></script><script src="/_next/static/f2LKLLTRFDOqa9_r6tCT6/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div class="navbar bg-base-100"><div class="navbar-start"><div class="dropdown"><label tabindex="0" class="btn btn-ghost lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16"></path></svg></label><ul tabindex="0" class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52"><li><a href="/posts">Posts</a></li><li><a href="/contact">Contact</a></li></ul></div><span class="btn btn-ghost normal-case"><img src="/ubaid_shaikh_logo.svg" alt="logo" height="100%" width="200"/></span></div><div class="navbar-end hidden lg:flex"><ul class="menu menu-horizontal p-0"><li><a href="/posts">Posts</a></li><li><a href="/contact">Contact</a></li></ul></div></div><div class="flex place-content-center"><div class="w-4/5"><br/><div class="link"><i class="ri-arrow-left-line"></i> Back to posts</div><br/><article class="prose prose-lg md:prose-xl"><h1>Extending WASM and WAT Backends</h1><h3>GSoC 22: Blog 3</h3><div class="flex justify-between"><div><i class="ri-calendar-2-line"></i> <!-- -->June 17, 2022</div><div><i class="ri-time-line"></i> <!-- -->2 min read</div></div></article><hr class="mt-5 mb-8"/><div class="w-3/4 w-full m-auto"><article class="prose prose-base"><div class="blog-content md:text-lg"><h1 id="hey-there-ðŸ¤—-welcome-to-my-gsoc-journey">Hey there ðŸ¤—, Welcome to my GSoC Journey</h1>
<p>This is a series of blogs that I am writing to share my amazing <strong>GSoC 22</strong> (Google Summer of Code 2022) Journey with you all. </p>
<hr>
<h1 id="extending-wasm-and-wat-backends">Extending WASM and WAT Backends</h1>
<p>In this phase, I focused on extending the <code>WASM</code> and <code>WAT</code> Backends.
Specifically, I added support for </p>
<ul>
<li><code>i64</code> constants/literals</li>
<li><code>unary minus</code> for <code>i32</code> and <code>i64</code></li>
<li>floating points <code>f32</code> and <code>f64</code><ul>
<li>constants/literals</li>
<li>unary minus</li>
<li>basic arithmetic operations</li>
</ul>
</li>
</ul>
<p>I also refactored the <code>WASM</code> and <code>WAT</code> Backends to hopefully improve them.</p>
<p>A challenge I faced during this phase was during the decoding the <code>i64</code> constants in the <code>WASM-&gt;WAT</code> backend.
I was following <a href="https://en.wikipedia.org/wiki/LEB128">Wikipedia/LEB128</a> for the encoding and decoding of <code>u32</code> and <code>i32</code> constants.
I followed the same for <code>i64</code> constants for encoding as well as decoding.
Even after following the same/similar algorithm as given in <a href="https://en.wikipedia.org/wiki/LEB128">Wikipedia/LEB128</a>,
the decoding was still not working correctly.
After much research, I found <a href="https://llvm.org/doxygen/LEB128_8h_source.html">this</a> which helped me find out the bug.</p>
<p>The bug was in the following code:</p>
<pre><code class="hljs language-cpp">byte = next byte in input;
result |= (byte &amp; <span class="hljs-number">0x7f</span>) &lt;&lt; shift;
shift += <span class="hljs-number">7</span>;
</code></pre>
<p>We see that in the middle line in the above code, we have <code>(byte &amp; 0x7f) &lt;&lt; shift</code>.
Since <code>byte</code> is of <code>8 bits</code> and <code>0x7f</code> is of <code>32 bits</code>, the result will be of <code>32 bits</code> and this is fine when <code>shift &lt; 32</code>.
Therefore, this code works for <code>i32</code> and <code>u32</code>, 
but did not work for <code>i64</code> as we might/would lose bits once the <code>shift</code> which might be <code>&gt;= 32</code> is applied .</p>
<p>The following code fixes the above issue:</p>
<pre><code class="hljs language-cpp">byte = next byte in input;
<span class="hljs-type">uint64_t</span> slice = (byte &amp; <span class="hljs-number">0x7f</span>);
result |= slice &lt;&lt; shift;
shift += <span class="hljs-number">7</span>;
</code></pre>
<p>This phase was mostly/approximately from <code>13-06-2022</code> to <code>17-06-2022</code>.</p>
<p>The MRs during this phase are as follows:</p>
<ul>
<li><a href="https://gitlab.com/lfortran/lfortran/-/merge_requests/1787">!1787</a></li>
<li><a href="https://gitlab.com/lfortran/lfortran/-/merge_requests/1789">!1789</a></li>
<li><a href="https://gitlab.com/lfortran/lfortran/-/merge_requests/1791">!1791</a></li>
<li><a href="https://gitlab.com/lfortran/lfortran/-/merge_requests/1792">!1792</a></li>
<li><a href="https://gitlab.com/lfortran/lfortran/-/merge_requests/1793">!1793</a></li>
</ul>
<hr>
<p>That's all for this blog. Thank you for your time. We continue this series in the next blog.</p>
</div></article></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"content":"\u003ch1 id=\"hey-there-ðŸ¤—-welcome-to-my-gsoc-journey\"\u003eHey there ðŸ¤—, Welcome to my GSoC Journey\u003c/h1\u003e\n\u003cp\u003eThis is a series of blogs that I am writing to share my amazing \u003cstrong\u003eGSoC 22\u003c/strong\u003e (Google Summer of Code 2022) Journey with you all. \u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"extending-wasm-and-wat-backends\"\u003eExtending WASM and WAT Backends\u003c/h1\u003e\n\u003cp\u003eIn this phase, I focused on extending the \u003ccode\u003eWASM\u003c/code\u003e and \u003ccode\u003eWAT\u003c/code\u003e Backends.\nSpecifically, I added support for \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ei64\u003c/code\u003e constants/literals\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eunary minus\u003c/code\u003e for \u003ccode\u003ei32\u003c/code\u003e and \u003ccode\u003ei64\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003efloating points \u003ccode\u003ef32\u003c/code\u003e and \u003ccode\u003ef64\u003c/code\u003e\u003cul\u003e\n\u003cli\u003econstants/literals\u003c/li\u003e\n\u003cli\u003eunary minus\u003c/li\u003e\n\u003cli\u003ebasic arithmetic operations\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI also refactored the \u003ccode\u003eWASM\u003c/code\u003e and \u003ccode\u003eWAT\u003c/code\u003e Backends to hopefully improve them.\u003c/p\u003e\n\u003cp\u003eA challenge I faced during this phase was during the decoding the \u003ccode\u003ei64\u003c/code\u003e constants in the \u003ccode\u003eWASM-\u0026gt;WAT\u003c/code\u003e backend.\nI was following \u003ca href=\"https://en.wikipedia.org/wiki/LEB128\"\u003eWikipedia/LEB128\u003c/a\u003e for the encoding and decoding of \u003ccode\u003eu32\u003c/code\u003e and \u003ccode\u003ei32\u003c/code\u003e constants.\nI followed the same for \u003ccode\u003ei64\u003c/code\u003e constants for encoding as well as decoding.\nEven after following the same/similar algorithm as given in \u003ca href=\"https://en.wikipedia.org/wiki/LEB128\"\u003eWikipedia/LEB128\u003c/a\u003e,\nthe decoding was still not working correctly.\nAfter much research, I found \u003ca href=\"https://llvm.org/doxygen/LEB128_8h_source.html\"\u003ethis\u003c/a\u003e which helped me find out the bug.\u003c/p\u003e\n\u003cp\u003eThe bug was in the following code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003ebyte = next byte in input;\nresult |= (byte \u0026amp; \u003cspan class=\"hljs-number\"\u003e0x7f\u003c/span\u003e) \u0026lt;\u0026lt; shift;\nshift += \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe see that in the middle line in the above code, we have \u003ccode\u003e(byte \u0026amp; 0x7f) \u0026lt;\u0026lt; shift\u003c/code\u003e.\nSince \u003ccode\u003ebyte\u003c/code\u003e is of \u003ccode\u003e8 bits\u003c/code\u003e and \u003ccode\u003e0x7f\u003c/code\u003e is of \u003ccode\u003e32 bits\u003c/code\u003e, the result will be of \u003ccode\u003e32 bits\u003c/code\u003e and this is fine when \u003ccode\u003eshift \u0026lt; 32\u003c/code\u003e.\nTherefore, this code works for \u003ccode\u003ei32\u003c/code\u003e and \u003ccode\u003eu32\u003c/code\u003e, \nbut did not work for \u003ccode\u003ei64\u003c/code\u003e as we might/would lose bits once the \u003ccode\u003eshift\u003c/code\u003e which might be \u003ccode\u003e\u0026gt;= 32\u003c/code\u003e is applied .\u003c/p\u003e\n\u003cp\u003eThe following code fixes the above issue:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003ebyte = next byte in input;\n\u003cspan class=\"hljs-type\"\u003euint64_t\u003c/span\u003e slice = (byte \u0026amp; \u003cspan class=\"hljs-number\"\u003e0x7f\u003c/span\u003e);\nresult |= slice \u0026lt;\u0026lt; shift;\nshift += \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis phase was mostly/approximately from \u003ccode\u003e13-06-2022\u003c/code\u003e to \u003ccode\u003e17-06-2022\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe MRs during this phase are as follows:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://gitlab.com/lfortran/lfortran/-/merge_requests/1787\"\u003e!1787\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gitlab.com/lfortran/lfortran/-/merge_requests/1789\"\u003e!1789\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gitlab.com/lfortran/lfortran/-/merge_requests/1791\"\u003e!1791\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gitlab.com/lfortran/lfortran/-/merge_requests/1792\"\u003e!1792\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gitlab.com/lfortran/lfortran/-/merge_requests/1793\"\u003e!1793\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eThat's all for this blog. Thank you for your time. We continue this series in the next blog.\u003c/p\u003e\n","frontmatter":{"slug":"gsoc_3_extending_wasm_and_wat_backends","excerpt":"GSoC 22: Blog 3","title":"Extending WASM and WAT Backends","publishedAt":"2022-06-17","day":"June 17, 2022","readingTime":"2 min read"}}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"gsoc_3_extending_wasm_and_wat_backends"},"buildId":"f2LKLLTRFDOqa9_r6tCT6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>